#! /usr/bin/env bash

usage() {
    echo "Usage: $0 -n <number> -m <number>"
    exit 1
}

sincere_number=""
liar_number=""

while getopts "n:m:" opt; do
    case $opt in
    m)
        # Check if the input is a valid integer
        if [[ "$OPTARG" =~ ^[0-9]+$ ]]; then
            sincere_number=$OPTARG
        else
            usage
        fi
        ;;
    n)
        # Check if the input is a valid integer
        if [[ "$OPTARG" =~ ^[0-9]+$ ]]; then
            liar_number=$OPTARG
        else
            usage
        fi
        ;;
    *)
        usage
        ;;
    esac
done

# Set default values if arguments are not provided
if [ -z "$sincere_number" ]; then
    sincere_number=1
fi

if [ -z "$liar_number" ]; then
    liar_number=0
fi

echo "Number of sincere nodes: $sincere_number"
echo "Numebr of liar nodes: $liar_number"

for ((i = 0; i < sincere_number; i++)); do
    python3 -m bitcoin.data.node &
done

for ((i = 0; i < liar_number; i++)); do
    python3 -m bitcoin.data.nodeLiaer &
done